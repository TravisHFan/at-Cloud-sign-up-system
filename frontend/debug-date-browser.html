<!DOCTYPE html>
<html>
  <head>
    <title>Date Bug Browser Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ccc;
      }
      .error {
        color: red;
        font-weight: bold;
      }
      .success {
        color: green;
        font-weight: bold;
      }
      .warning {
        color: orange;
        font-weight: bold;
      }
      input[type="date"] {
        padding: 8px;
        margin: 5px 0;
      }
      button {
        padding: 10px 15px;
        margin: 5px;
      }
      pre {
        background: #f5f5f5;
        padding: 10px;
        overflow: auto;
      }
    </style>
  </head>
  <body>
    <h1>üîç Date Bug Browser Investigation</h1>

    <div class="test-section">
      <h2>Test 1: Basic Date Input</h2>
      <label>Select a date (try 2025-07-23):</label><br />
      <input type="date" id="testDateInput" value="2025-07-23" />
      <div id="basicResults"></div>
    </div>

    <div class="test-section">
      <h2>Test 2: React Hook Form Simulation</h2>
      <button onclick="simulateFormSubmission()">Simulate Form Submit</button>
      <div id="formResults"></div>
    </div>

    <div class="test-section">
      <h2>Test 3: Validation Display</h2>
      <button onclick="testValidationDisplay()">Test Validation Logic</button>
      <div id="validationResults"></div>
    </div>

    <div class="test-section">
      <h2>Test 4: Live Environment Info</h2>
      <div id="envInfo"></div>
    </div>

    <script>
      // Copy our date handling functions
      function normalizeEventDate(dateInput) {
        if (!dateInput) return "";

        const cleanInput = dateInput.trim();
        console.log("üîç normalizeEventDate input:", cleanInput);

        const yyyymmddMatch = cleanInput.match(/^(\d{4})-(\d{2})-(\d{2})$/);
        if (yyyymmddMatch) {
          const [, year, month, day] = yyyymmddMatch;
          const yearNum = parseInt(year);
          const monthNum = parseInt(month);
          const dayNum = parseInt(day);

          if (
            yearNum >= 1900 &&
            yearNum <= 9999 &&
            monthNum >= 1 &&
            monthNum <= 12 &&
            dayNum >= 1 &&
            dayNum <= 31
          ) {
            console.log(
              "‚úÖ normalizeEventDate output (already valid):",
              cleanInput
            );
            return cleanInput;
          }
        }

        return cleanInput;
      }

      function handleDateInputChange(inputValue) {
        if (!inputValue) return "";

        console.log("üìÖ Date input change:", inputValue);

        if (/^\d{4}-\d{2}-\d{2}$/.test(inputValue)) {
          console.log("‚úÖ Date input preserved:", inputValue);
          return inputValue;
        }

        const normalized = normalizeEventDate(inputValue);
        console.log("üîÑ Date input normalized:", normalized);
        return normalized;
      }

      // Test 1: Basic date input monitoring
      const dateInput = document.getElementById("testDateInput");
      const basicResults = document.getElementById("basicResults");

      function updateBasicResults() {
        const value = dateInput.value;
        const dateObj = new Date(value);
        const processed = handleDateInputChange(value);

        basicResults.innerHTML = `
                <h3>Results:</h3>
                <p><strong>Raw input value:</strong> ${value}</p>
                <p><strong>Date object:</strong> ${dateObj.toString()}</p>
                <p><strong>Local date parts:</strong> ${dateObj.getFullYear()}-${String(
          dateObj.getMonth() + 1
        ).padStart(2, "0")}-${String(dateObj.getDate()).padStart(2, "0")}</p>
                <p><strong>UTC date parts:</strong> ${dateObj.getUTCFullYear()}-${String(
          dateObj.getUTCMonth() + 1
        ).padStart(2, "0")}-${String(dateObj.getUTCDate()).padStart(2, "0")}</p>
                <p><strong>toISOString():</strong> ${dateObj.toISOString()}</p>
                <p><strong>toISOString().split('T')[0]:</strong> ${
                  dateObj.toISOString().split("T")[0]
                }</p>
                <p><strong>Our function result:</strong> ${processed}</p>
                <p class="${
                  value === processed ? "success" : "error"
                }"><strong>Match:</strong> ${
          value === processed ? "YES" : "NO - ISSUE FOUND!"
        }</p>
            `;
      }

      dateInput.addEventListener("change", updateBasicResults);
      updateBasicResults(); // Initial test

      // Test 2: Form submission simulation
      function simulateFormSubmission() {
        const formData = {
          date: dateInput.value,
          title: "Test Event",
          time: "10:00",
        };

        console.log("üîç Form submission simulation:");
        console.log("Original form data:", formData);

        // Simulate our current processing
        const normalizedDate = normalizeEventDate(formData.date);

        const processedFormData = {
          ...formData,
          date: normalizedDate,
        };

        console.log("Processed form data:", processedFormData);

        document.getElementById("formResults").innerHTML = `
                <h3>Form Submission Simulation:</h3>
                <pre>Original: ${JSON.stringify(formData, null, 2)}</pre>
                <pre>Processed: ${JSON.stringify(
                  processedFormData,
                  null,
                  2
                )}</pre>
                <p class="${
                  formData.date === processedFormData.date ? "success" : "error"
                }">
                    <strong>Date preserved:</strong> ${
                      formData.date === processedFormData.date
                        ? "YES"
                        : "NO - ISSUE!"
                    }
                </p>
            `;
      }

      // Test 3: Validation display (this might be where the issue is!)
      function testValidationDisplay() {
        const testDate = dateInput.value;

        // Simulate different validation scenarios
        const scenarios = [
          {
            name: "Direct display",
            result: testDate,
          },
          {
            name: "Through Date object",
            result: new Date(testDate).toISOString().split("T")[0],
          },
          {
            name: "Local date formatting",
            result: (() => {
              const d = new Date(testDate);
              return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(
                2,
                "0"
              )}-${String(d.getDate()).padStart(2, "0")}`;
            })(),
          },
          {
            name: "UTC date formatting",
            result: (() => {
              const d = new Date(testDate);
              return `${d.getUTCFullYear()}-${String(
                d.getUTCMonth() + 1
              ).padStart(2, "0")}-${String(d.getUTCDate()).padStart(2, "0")}`;
            })(),
          },
          {
            name: "Our normalize function",
            result: normalizeEventDate(testDate),
          },
        ];

        let html = "<h3>Validation Display Test:</h3>";
        scenarios.forEach((scenario) => {
          const isCorrect = scenario.result === testDate;
          html += `
                    <p class="${isCorrect ? "success" : "error"}">
                        <strong>${scenario.name}:</strong> ${scenario.result} 
                        ${isCorrect ? "‚úÖ" : "‚ùå SHOWS WRONG DATE!"}
                    </p>
                `;
        });

        document.getElementById("validationResults").innerHTML = html;
      }

      // Test 4: Environment info
      function showEnvironmentInfo() {
        const now = new Date();
        document.getElementById("envInfo").innerHTML = `
                <h3>Browser Environment:</h3>
                <p><strong>Current time:</strong> ${now.toString()}</p>
                <p><strong>Timezone offset:</strong> ${now.getTimezoneOffset()} minutes</p>
                <p><strong>Timezone:</strong> ${
                  Intl.DateTimeFormat().resolvedOptions().timeZone
                }</p>
                <p><strong>User Agent:</strong> ${navigator.userAgent}</p>
                <p><strong>Platform:</strong> ${navigator.platform}</p>
                <p><strong>Language:</strong> ${navigator.language}</p>
            `;
      }

      showEnvironmentInfo();

      // Console logging for debugging
      console.log("üîç Browser Date Bug Test Loaded");
      console.log("Test with date input value:", dateInput.value);
    </script>
  </body>
</html>
