# Optimized MongoDB Configuration for Heavy Test Loads
# This configuration reduces the chance of MongoDB crashes during integration tests
# by optimizing WiredTiger cache, connection handling, and write operations

systemLog:
  destination: file
  path: /opt/homebrew/var/log/mongodb/mongo.log
  logAppend: true
  # Reduce verbose logging to decrease I/O load
  verbosity: 0

storage:
  dbPath: /opt/homebrew/var/mongodb
  # Reduce checkpoint frequency to decrease I/O pressure
  # (default is 60 seconds, we increase to 120 for tests)
  syncPeriodSecs: 120
  # WiredTiger storage engine settings
  wiredTiger:
    engineConfig:
      # Cache size: 50% of RAM (adjust based on your system)
      # Prevents memory exhaustion that can cause crashes
      cacheSizeGB: 8
      # Enable journaling for crash recovery
      journalCompressor: snappy
    collectionConfig:
      # Use snappy compression to reduce disk I/O
      blockCompressor: snappy
    indexConfig:
      # Prefix compression for indexes
      prefixCompression: true

net:
  bindIp: 127.0.0.1, ::1
  ipv6: true
  # Increase max connections to handle test suite
  maxIncomingConnections: 1000
  # Connection pool settings
  wireObjectCheck: true

# Operational parameters to prevent crashes
operationProfiling:
  # Disable profiling in test environment to reduce overhead
  mode: off
